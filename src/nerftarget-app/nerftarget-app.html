<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/app-layout/app-layout.html">
<link rel="import" href="../../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../nerftarget-bearing/nerftarget-bearing.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../nerftarget-simplegraph/nerftarget-simplegraph.html">
<link rel="import" href="../nerftarget-lpf/nerftarget-lpf.html">



<dom-module id="nerftarget-app">
  <template>
    <style>
      :host {
        position: fixed;
        top:0;
        bottom:0;
        left:0;
        right:0;
        display: block;
        font-family: sans-serif;
        background-color: var(--paper-grey-50);
        text-align:center; 
        display: flex;       
        flex-direction: column;
      }

      app-toolbar {
        background-color: var(--paper-blue-500);
        color: white;
      }

      paper-button {
        background-color: var(--paper-blue-500);
        color:white;
      }

      #content {
        color: var(--paper-grey-800);
        position: relative;
        flex:1;
        text-align: left;
        overflow: hidden;
      }

      #dot {
        background: red;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        background-clip: border-box;
        position:absolute;
        top: 50%;
        left: 50%;
      }

      #text {
        margin: 1em auto;
        max-width: 70ex;
        line-height: 1.5em;
        font-size:16px;
      }

      .hitcounter {
        font-size: 120px;
        line-height:2em;
        font-family: monospace;
      }

      nerftarget-simplegraph {
        position: absolute;
        top:0;
        left:0;
      }
    </style>
      <app-toolbar>
        <template is="dom-if" if="{{!device}}">
          <paper-button id="connect" raised on-tap="connect">Connect</paper-button>
        </template>
        <template is="dom-if" if="{{device}}">
          <paper-button id="disconnect" raised on-tap="disconnect">Disconnect</paper-button>
        </template>
      </app-toolbar>
      <div id="content">
        <div id="text">
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus molestie diam iaculis egestas sollicitudin. Sed eu libero eros. Duis eget dictum diam. Praesent eget nibh sit amet sapien condimentum feugiat sed vel enim. Phasellus id enim vel orci mollis commodo id in mi. Proin varius egestas egestas. Proin ullamcorper enim eros, ut aliquam velit feugiat eget. Donec dapibus nisi id enim tincidunt, rutrum aliquet sem ultrices.</p>

<p>Maecenas purus ipsum, lacinia sollicitudin mauris quis, elementum feugiat diam. Suspendisse eget egestas eros. Proin facilisis dapibus semper. Quisque sed egestas erat. Nam blandit enim at ultricies ullamcorper. Morbi scelerisque elit vel porttitor aliquam. Sed cursus pellentesque nibh. Donec ut erat et nulla porta placerat. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus ac accumsan neque. Pellentesque varius, ligula et cursus convallis, arcu sem semper ipsum, eget pellentesque orci nibh eget ante. Vestibulum libero tortor, mattis ut mauris eu, lacinia iaculis ex. Nulla facilisi. Sed dapibus, ligula non commodo vestibulum, diam lorem iaculis ante, ut vehicula metus dolor in magna. Cras faucibus turpis in ullamcorper accumsan. Suspendisse porta arcu quam.</p>

<p>Sed tincidunt, eros in tempus dignissim, erat nulla dapibus dui, et condimentum est dui vitae leo. Praesent posuere mauris eu nunc aliquet, a dignissim quam interdum. Quisque efficitur dui id nunc sollicitudin porttitor. Donec ante augue, bibendum pulvinar quam in, bibendum condimentum turpis. Mauris bibendum semper lorem, ut viverra dolor commodo ut. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Aenean porta consectetur arcu, non porttitor turpis auctor ac. Nunc sapien magna, volutpat a justo sed, congue fermentum dolor. Suspendisse a velit posuere, vulputate velit ac, luctus nibh. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Duis vel efficitur leo, aliquet feugiat purus. Pellentesque tortor magna, tempor eget enim vel, feugiat fringilla risus. Vivamus volutpat odio ac lorem lobortis mattis. Fusce vel dignissim velit. Fusce semper luctus dictum.</p>
        </div>
      </div>
      <nerftarget-lpf value="{{ry}}" smooth="{{y}}"></nerftarget-lpf>
      <nerftarget-bearing device="{{device}}" roll="{{x}}" pitch="{{ry}}" yaw="{{z}}" bearing="{{b}}"></nerftarget-bearing>
  </template>

  <script>
    Polymer({
      properties: {
        device: {
          type: Object
        },
        x: {
          type: Number,
          observer: "repaint"
        },
        y: {
          type: Number,
          observer: "repaint"          
        }
      },

      is: 'nerftarget-app',
      ready: function() {
        var littleEndian = (function() {
          var buffer = new ArrayBuffer(2);
          new DataView(buffer).setInt16(0, 256, true /* littleEndian */);
          // Int16Array uses the platform's endianness.
          return new Int16Array(buffer)[0] === 256;
        })();
        console.log('littleEndian: '+littleEndian); // true or false
      },
      connect: function(){
        this.$$('nerftarget-bearing').connect();
        this.hitCount = 0;
      },
      disconnect: function() {
        this.$$('nerftarget-bearing').disconnect();
      },
      repaint: function() {
        let x = this.x;
        let y = this.y;
        this.$$('#text').style.transform=`rotate(${y}deg)`;
      }
    });
  </script>
</dom-module>
