<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="nerftarget-graph">
    <template>
        <style>
            :host {
                 display:block;
            }
        </style>
        <canvas width="400" height="200"></canvas>
    </template>
    <script>
        Polymer({
            is:'nerftarget-graph',
            properties: {
                series: {
                    type:Array,
                    value:[]
                },
                median: {
                    type: Number
                },
                hitLevel: {
                    type:Number
                }
            },
            rafId: null,
            observers: [
                'repaint(series.splices)'
            ],
            ready: function(){
                this.canvas = this.$$('canvas');
            },
            repaint: function() {
                if(!this.rafId && this.canvas) {
                    this.rafId = window.requestAnimationFrame(this.paint.bind(this));
                }
            },
            paint: function() {
                let ctx = this.canvas.getContext('2d');
                let i;
                let h = this.canvas.height;
                let medianY = h -  this.median;
                let hitLevelHighY = h - this.median + this.median * this.hitLevel;
                let hitLevelLowY = h - this.median - this.median * this.hitLevel;
                this.canvas.width=400;
                ctx.beginPath();
                ctx.strokeStyle = '#222222';
                ctx.moveTo(0, h - this.series[0]);
                for(i=1; i< this.series.length; i++) {
                    ctx.lineTo(i,h-this.series[i]);
                }

                ctx.stroke();
                ctx.beginPath();
                ctx.strokeStyle = 'blue';
                ctx.moveTo(0, medianY);
                ctx.lineTo(this.canvas.width, medianY);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.strokeStyle = 'red';
                ctx.moveTo(0, hitLevelHighY);
                ctx.lineTo(this.canvas.width, hitLevelHighY );
                ctx.moveTo(0, hitLevelLowY);
                ctx.lineTo(this.canvas.width, hitLevelLowY );
                ctx.stroke();
                
                this.rafId = null;
            }
        })
    </script>
</dom-module>