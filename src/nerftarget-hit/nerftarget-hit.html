<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="nerftarget-hit">
    <template>
        <style>
            :host {
                 display:none;
            }
        </style>
    </template>
    <script>
        Polymer({
            properties: {
                hit: {
                    value:false,
                    notify: true
                },
                currentVector: {
                    type:Number,
                    value:0,
                    observer: "currentVectorChanged"
                },
                lastItems: {
                    type:Array,
                    value: []
                },
                currentMedian: {
                    type:Number,
                    value:0,
                    notify: true
                },
                hitLevel: {
                    type: Number,
                    value:1.9
                }
            },
            countMedian: function(a) {
                return a.reduce((current, prev) => prev + current,0) / a.length;
            },
            currentVectorChanged: function(newVal) {
                if(this.lastItems) {
                    this.lastItems.push(newVal);
                    if(this.lastItems.length > 30) {
                        this.lastItems.shift();
                    }
                    this.currentMedian = this.countMedian(this.lastItems);
                    this.hit = newVal > this.currentMedian * this.hitLevel;
                    if(this.hit) {
                        console.log(this.currentMedian, newVal, this.hit);
                    } 
                }
            },

            is:'nerftarget-hit'
        })
    </script>
</dom-module>